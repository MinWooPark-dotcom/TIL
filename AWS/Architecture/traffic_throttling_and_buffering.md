# Traffic Throttling & Buffering Architecture in AWS

## 1. 개요

트래픽이 갑자기 급증할 경우(예: 이벤트, 인기 콘텐츠 등), 백엔드 시스템이 과부하되어 응답 지연 또는 장애가 발생할 수 있다. 이를 방지하기 위해 **AWS에서는 프론트엔드에서 요청을 제한하고(Throttling), 백엔드에서는 요청을 버퍼링(Buffering)하는 아키텍처**를 구성할 수 있다.

---

## 2. 아키텍처 구성도

[Client Request]
↓
[API Gateway] ← Throttle 설정 (요청 제한)
↓
[SQS or Kinesis] ← 버퍼링 (비동기 큐 or 스트림)
↓
[Lambda or EC2] ← 백엔드 소비자, 점진적 처리

---

## 3. 사용 서비스와 역할

| 서비스 | 역할 | 핵심 기능 |
|--------|------|-----------|
| **Amazon API Gateway** | 요청 제한 (Throttle) | 초당 요청 수(rate) 및 버스트 제한 가능 |
| **Amazon SQS** | 메시지 큐 버퍼링 | 요청을 큐에 저장하고 백엔드가 천천히 처리 |
| **Amazon Kinesis** | 스트림 버퍼링 | 대용량 실시간 데이터 수집 및 소비 속도 제어 |
| **AWS Lambda / Amazon EC2** | 처리 엔진 | 큐/스트림에서 메시지를 꺼내 처리함 |

---

## 4. 왜 이 아키텍처가 필요한가?

- 갑작스러운 트래픽(예: 마케팅 이벤트, 게임 랭킹 공개 등) 발생 시:
  - 요청이 백엔드 서버에 몰리면 성능 저하, 장애 발생
  - 사용자에게는 5xx 오류 또는 지연 발생
- 해결 방법:
  - **API Gateway**에서 요청 자체를 제한 (rate limiting)
  - **SQS/Kinesis**에서 비동기 처리를 통해 버퍼링
  - **Lambda/EC2**가 안정적인 속도로 처리

---

## 5. SQS vs Kinesis 차이

| 항목 | SQS | Kinesis |
|------|-----|---------|
| 모델 | 메시지 큐 | 데이터 스트림 |
| 처리 순서 | 보장되지 않음 (FIFO 지원 있음) | 샤드별 순서 보장 |
| 메시지 보존 | 최대 14일 | 최대 365일 (Pro) |
| 사용 예시 | API 요청 처리, 이메일 전송, 작업 큐 | 로그 수집, 실시간 분석, IoT 데이터 |

---

## 6. 실무 팁

- Lambda를 SQS나 Kinesis에 연결하면 자동으로 소비 처리 가능
- 처리량이 예상보다 적으면 큐 길이를 CloudWatch로 모니터링하여 경고 알림 설정
- API Gateway → SQS는 속도 제한과 비동기 처리를 함께 구성할 수 있어 강력한 패턴

---

## 핵심 요약

- 트래픽 급증 → API Gateway에서 throttle → SQS/Kinesis에 버퍼링 → Lambda/EC2가 점진적으로 처리
- **백엔드 보호** + **고가용성** + **비동기 처리 확장성 확보**
